{{ define "title" }}
  {{- .Title }} - {{ .Site.Title -}}
{{ end }}
{{ define "main" }}

{{ $today := dateFormat "2006-01-02" now }}
{{ $all := sort $.Site.Data.series "date" }}
{{ $filter := where $all "service" .Title }}
{{ $later := where $filter "date" "gt" $today }}
{{ $earlier := where $filter "date" "le" $today }}
{{ $twoweeks := time.Duration "hour" -336 }}
{{ $weeksago := now.Add $twoweeks }}
{{ $recent_date := dateFormat "2006-01-02" $weeksago }}
{{ $recent := where $earlier "date" "gt" $recent_date }}
  
<h1>{{ .Title }}</h1>

{{ if $recent }}
<h2>New</h2>
<ul class="pagelist">
{{ range $recent }}
  <li><em>{{ .name }}</em>, Season {{ .season }} &mdash; ({{ .service }}): {{ if .displayDate }} {{ .displayDate }}{{ else }}{{ dateFormat "Jan 2, 2006" .date }}{{ end }}
{{ end }}
</ul>
{{ end }}

{{ if $later }}
<h2>Coming Soon</h2>
<ul class="pagelist">
{{ range $later }}
  <li><em>{{ .name }}</em>, Season {{ .season }} &mdash; ({{ .service }}): {{ if .displayDate }} {{ .displayDate }}{{ else }}{{ dateFormat "Jan 2, 2006" .date }}{{ end }}
{{ end }}
</ul>
{{ end }} 
{{ end }}
